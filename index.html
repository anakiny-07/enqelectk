<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบค้นหากลุ่มจังหวัดออกเสียงประชามตินอกเขต</title>
    
    <!-- นำเข้า Tailwind CSS สำหรับความสวยงาม -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- นำเข้า React และ Babel สำหรับการทำงาน -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- ฟอนต์ภาษาไทย -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <div id="root"></div>

    <script type="text/babel">
        // --- การตั้งค่า (Configuration) ---
        // 1. นำลิงก์ CSV จาก Google Sheet (Menu: File > Share > Publish to web > เลือก CSV) มาวางในเครื่องหมายคำพูดด้านล่าง
        // ตัวอย่าง: const GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/.../pub?output=csv";
        const GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRMCW4h7i974_KGO1cWBNLeCTuCA80qO7wsUJhZPBYmXlNapbYT4l_pw3N4joUuj4h_uekoTPXq0l-J/pub?output=csv"; 

        const { useState, useEffect } = React;

        // ไอคอน (Inline SVGs)
        const Icons = {
            Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            Database: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s 9-1.34 9-3V5"/></svg>,
            MapPin: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
            AlertCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
            Settings: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
        };

        function App() {
            const [data, setData] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [filteredResults, setFilteredResults] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);

            // ฟังก์ชันแปลง CSV เป็น JSON
            const parseCSV = (text) => {
                const lines = text.split('\n');
                return lines.slice(1).map((line, index) => {
                    const values = line.split(',');
                    // คาดหวัง: values[0]=ชุดที่, values[1]=ภาค, values[2]=จังหวัด
                    return {
                        id: index,
                        group: values[0]?.trim() || "-",
                        region: values[1]?.trim() || "-",
                        province: values[2]?.trim() || "-"
                    };
                }).filter(item => item.province !== "-" && item.province !== "");
            };

            useEffect(() => {
                if (!GOOGLE_SHEET_CSV_URL) return;

                const fetchData = async () => {
                    setIsLoading(true);
                    setError(null);
                    try {
                        // แก้ไข: ใช้ Proxy (allorigins) เพื่อแก้ปัญหา CORS (Failed to fetch) เวลาเปิดไฟล์จากเครื่องตัวเอง
                        const targetUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(GOOGLE_SHEET_CSV_URL)}`;
                        
                        const response = await fetch(targetUrl);
                        if (!response.ok) throw new Error('ไม่สามารถเชื่อมต่อกับ Google Sheet ได้ (ตรวจสอบลิงก์ หรือสถานะ Public)');
                        const text = await response.text();
                        const parsedData = parseCSV(text);
                        setData(parsedData);
                    } catch (err) {
                        setError('เกิดข้อผิดพลาด: ' + err.message + ' (ลองตรวจสอบลิงก์ CSV อีกครั้ง)');
                    } finally {
                        setIsLoading(false);
                    }
                };
                fetchData();
            }, []);

            // ระบบค้นหา (ทำงานเมื่อพิมพ์ครบ 3 ตัวอักษร)
            useEffect(() => {
                const cleanTerm = searchTerm.trim();
                if (cleanTerm.length >= 3) {
                    const results = data.filter(item => 
                        item.province && item.province.includes(cleanTerm)
                    );
                    setFilteredResults(results);
                } else {
                    setFilteredResults([]);
                }
            }, [searchTerm, data]);

            return (
                <div className="min-h-screen pb-12">
                    {/* Header */}
                    <div className="bg-gradient-to-r from-blue-700 to-indigo-800 text-white py-8 px-4 shadow-lg">
                        <div className="max-w-3xl mx-auto text-center">
                            <div className="flex justify-center mb-4 opacity-90">
                                <Icons.Database />
                            </div>
                            <h1 className="text-3xl md:text-4xl font-bold mb-2">ระบบค้นหากลุ่มจังหวัดเลือกตั้ง</h1>
                            <p className="text-blue-100 text-sm md:text-base">ตรวจสอบข้อมูล ชุดที่, ภาค และจังหวัด</p>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="max-w-3xl mx-auto px-4 -mt-6">

                        {/* กรณี: ยังไม่ได้ใส่ลิงก์ */}
                        {!GOOGLE_SHEET_CSV_URL && (
                            <div className="bg-white rounded-xl shadow-xl p-8 mb-8 text-center border-l-4 border-amber-500">
                                <div className="text-amber-500 mx-auto mb-4 flex justify-center"><Icons.Settings /></div>
                                <h2 className="text-xl font-bold text-slate-800 mb-2">ยังไม่ได้ตั้งค่าลิงก์ข้อมูล</h2>
                                <p className="text-slate-600 mb-4">
                                    กรุณาเปิดไฟล์นี้ด้วย Notepad แล้วนำลิงก์ CSV มาวางที่บรรทัด <code>const GOOGLE_SHEET_CSV_URL = "..."</code>
                                </p>
                            </div>
                        )}

                        {/* กรณี: มีลิงก์แล้ว */}
                        {GOOGLE_SHEET_CSV_URL && (
                            <div className="bg-white rounded-xl shadow-xl p-6 md:p-8 mb-8">
                                <label className="block text-sm font-medium text-slate-600 mb-2">ค้นหาจังหวัด</label>
                                <div className="relative">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400">
                                        <Icons.Search />
                                    </div>
                                    <input
                                        type="text"
                                        className="block w-full pl-10 pr-3 py-3 border border-slate-300 rounded-lg leading-5 bg-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out sm:text-lg"
                                        placeholder="พิมพ์ชื่อจังหวัด..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                </div>
                                <div className="mt-3 flex items-center text-sm">
                                    {searchTerm.length > 0 && searchTerm.length < 3 ? (
                                        <span className="text-amber-600 flex items-center bg-amber-50 px-3 py-1 rounded-full">
                                            <span className="mr-1"><Icons.AlertCircle /></span>
                                            กรุณาพิมพ์อย่างน้อย 3 ตัวอักษร
                                        </span>
                                    ) : (
                                        <span className="text-slate-500">* พิมพ์ชื่อจังหวัดอย่างน้อย 3 ตัวอักษรเพื่อค้นหา</span>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Loading */}
                        {isLoading && (
                            <div className="text-center py-12">
                                <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-700 mx-auto mb-4"></div>
                                <p className="text-slate-500">กำลังเชื่อมต่อข้อมูลจาก Google Sheet...</p>
                            </div>
                        )}

                        {/* Error */}
                        {error && (
                            <div className="bg-red-50 border border-red-200 rounded-lg p-6 text-center text-red-700">
                                <p className="font-medium">{error}</p>
                                <p className="text-sm mt-2">โปรดตรวจสอบว่าได้ตั้งค่า Google Sheet เป็น <strong>"Public (เผยแพร่ทางเว็บ)"</strong> เรียบร้อยแล้ว</p>
                            </div>
                        )}

                        {/* Results */}
                        {!isLoading && !error && GOOGLE_SHEET_CSV_URL && (
                            <div className="space-y-4">
                                {searchTerm.length >= 3 && filteredResults.length === 0 ? (
                                    <div className="text-center py-12 bg-white rounded-lg border border-slate-200 shadow-sm">
                                        <div className="bg-slate-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-400">
                                            <Icons.Search />
                                        </div>
                                        <h3 className="text-lg font-medium text-slate-900">ไม่พบข้อมูล</h3>
                                        <p className="text-slate-500">ไม่มีจังหวัดที่ตรงกับคำว่า "{searchTerm}"</p>
                                    </div>
                                ) : (
                                    <>
                                        {filteredResults.length > 0 && (
                                            <div className="flex items-center justify-between mb-2 px-1">
                                                <h2 className="text-xl font-bold text-slate-800">ผลการค้นหา</h2>
                                                <span className="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-md font-medium">พบ {filteredResults.length} รายการ</span>
                                            </div>
                                        )}
                                        <div className="grid grid-cols-1 gap-4">
                                            {filteredResults.map((item, idx) => (
                                                <div key={idx} className="bg-white border border-slate-200 rounded-lg shadow-sm hover:shadow-md transition-shadow p-5 flex flex-col sm:flex-row sm:items-center justify-between group border-l-4 border-l-blue-500">
                                                    <div className="flex-1 mb-4 sm:mb-0">
                                                        <div className="flex items-center mb-1">
                                                            <span className="text-blue-500 mr-2"><Icons.MapPin /></span>
                                                            <h3 className="text-lg font-bold text-slate-900 group-hover:text-blue-700 transition-colors">จ.{item.province}</h3>
                                                        </div>
                                                        <p className="text-slate-500 text-sm pl-8">ภาค: <span className="text-slate-800 font-medium">{item.region}</span></p>
                                                    </div>
                                                    <div className="flex items-center sm:justify-end">
                                                        <div className="text-center bg-slate-50 px-6 py-2 rounded-lg border border-slate-100">
                                                            <span className="block text-xs text-slate-500 uppercase tracking-wider font-semibold">ชุดที่</span>
                                                            <span className="block text-2xl font-bold text-blue-600">{item.group}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>